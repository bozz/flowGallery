/*
 * jQuery flowGallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowGallery
 * version 0.6.0 (26-FEB-2011)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(f){f.fn.flowGallery=function(x){l=f.extend(f.fn.flowGallery.defaults,x);return this.each(function(y){a(this)})};f.fn.flowGallery.defaults={activeIndex:0,animate:true,enableKeyNavigation:true,forceWidth:false,forceHeight:false,backgroundColor:"black",thumbWidth:100,thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,thumbPadding:3,loadingClass:"loading",easing:"linear",duration:900};var l={};var u=0;var k=0;var p=false;var e=false;var m=false;var w=0;var i=0;var t=0;var s=0;var g=[];var a=function(z){m=z;var x=f(m).css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}).parent();var C=document.createElement("div");var B=document.createElement("p");f(B).addClass("bf-caption").css({backgroundColor:l.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(l.imagePadding+10)+"px 15px",position:"absolute"});f(C).addClass("bf-wrapper").css({position:"relative"}).append(m).append(B);x.append(C);f(window).resize(function(){w=f(document.body).width();t=w*0.5;r();n(p)});var A=f(m).children();var y=false;A.each(function(F){var E=f(this).find("img");if(l.forceWidth){E.width(l.forceWidth)}var D=j(E.get(0));var G=v(E,D);g.push(G);d(E,F);if(F===k&&D){y=G.h}q(this,F)});w=f(document.body).width();t=w*0.5;if(y){s=l.thumbTopOffset==="auto"?y*0.5:l.thumbTopOffset}else{s=l.thumbTopOffset==="auto"?i*0.5:l.thumbTopOffset+l.thumbHeight*0.5}if(l.enableKeyNavigation){f(document).keydown(function(D){if(D.keyCode===37){c(-1)}else{if(D.keyCode===39){c(1)}}})}r()};var q=function(y,x){f(y).css({backgroundColor:l.backgroundColor,position:"absolute",textAlign:"center"}).find("img").css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"});if(!p&&l.activeIndex===x){f(y).addClass("active");p=y;k=x}u++};var r=function(z){var B=true;var y,C,G,D,F=0;var E=null;var x=function(){n(p);if(f(document.body).width()!==w){w=f(document.body).width();t=w*0.5;r();n(p)}};var A={};f(m).children().each(function(H){if(f(this).hasClass("active")){A={left:(t-l.imagePadding-g[H].w*0.5)+"px",top:"0",width:g[H].w+"px",height:g[H].h+"px",padding:l.imagePadding+"px"};B=false;E=x}else{A={left:(B?(t-l.imagePadding-g[k].w*0.5+(H-k)*g[H].tw+(H-1-k)*10):(t+l.imagePadding+g[k].w*0.5+(H-k-1)*g[H].tw+(H-k)*10))+"px",top:(s-g[H].th*0.5)+"px",width:g[H].tw+"px",height:g[H].th+"px",padding:l.thumbPadding+"px"};E=null}if(z){f(this).stop().animate(A,{duration:l.duration,easing:l.easing,complete:E})}else{f(this).css(A);if(E){E()}}})};var n=function(A){var z=f(A).find("img").get(0);if(!j(z)){return false}var y=f(A).parent().parent().find("p.bf-caption");var B=z.title;if(z.title.length>0){y.text(B);y.css({left:t-l.imagePadding-g[k].w*0.5,top:g[k].h+l.imagePadding*2,width:g[k].w-20});var x=f(m).height()+y.height()+40;f(m).parent().height(x);y.fadeIn("fast")}};var v=function(A,y){y=y||false;var z,x,D=0;if(y){var C=A.get(0);if(typeof C.naturalWidth!=="undefined"){z=l.forceWidth||A.attr("naturalWidth")||A.attr("width");x=l.forceHeight||A.attr("naturalHeight")||A.attr("height")}else{var B=new Image();B.src=A.attr("src");z=B.width;x=B.height}D=l.thumbHeight==="auto"?Math.round(x*Number(l.thumbWidth)/z):l.thumbHeight}else{D=l.thumbHeight==="auto"?50:l.thumbHeight;x=D;z=l.thumbWidth}b(x);return{h:x,w:z,th:D,tw:l.thumbWidth}};var j=function(x){if((l.forceWidth&&l.forceHeight)||(x.width>l.thumbWidth&&x.height>20)){return true}if(!x.complete){return false}if(typeof x.naturalWidth!=="undefined"&&x.naturalWidth===0){return false}return true};var d=function(x,y){x.hide().parent().addClass(l.loadingClass).css({height:g[y].th,width:g[y].tw});var z=function(C){if(this.complete||(this.readyState==="complete"&&C.type==="readystatechange")){f(this).css("visibility","visible").parent().removeClass(l.loadingClass);f(this).fadeIn();var B=v(x,true);g[y]=B;if(y===l.activeIndex){e=true;s=l.thumbTopOffset==="auto"?B.h*0.5:l.thumbTopOffset;if(C){r()}}else{var D={height:B.th};if(e){D.top=(s-g[y].th*0.5)+"px"}x.parent().animate(D)}o(x.parent())}};var A=x.get(0);if(A.complete){z.call(A)}else{x.bind("load readystatechange",z).bind("error",function(){f(this).css("visibility","visible").parent().removeClass(l.loadingClass)})}};var o=function(x){f(x).click(function(){if(this!==p){f("p.bf-caption").hide();k=0;p=this;f(this).parent().children().each(function(y){if(p===this){k=y}});h();r(l.animate)}})};var c=function(x){if(x<0&&k>0){k+=x}else{if(x>0&&k<g.length-1){k+=x}else{return false}}p=f(m).children().get(k);h();r(l.animate)};var h=function(x){f("p.bf-caption").hide();f(m).find(".active").removeClass("active");f(p).addClass("active");w=f(document.body).width();t=w*0.5};var b=function(x){if(x>i){i=x;i+=l.imagePadding*2;f(m).height(i)}}})(jQuery);