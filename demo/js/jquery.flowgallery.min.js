/*
 * jQuery flowGallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowGallery
 * version 0.6.1 (26-FEB-2011)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(d){d.fn.flowGallery=function(n){k=d.extend(d.fn.flowGallery.defaults,n);return this.each(function(o){b(this)})};d.fn.flowGallery.defaults={activeIndex:0,animate:true,enableKeyNavigation:true,forceWidth:false,forceHeight:false,backgroundColor:"black",thumbWidth:100,thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,thumbPadding:3,loadingClass:"loading",easing:"linear",duration:900};var k={};var b=function(p){_elCounter=0;_activeIndex=0;_activeElem=false;_activeLoaded=false;_listElem=false;_listWidth=0;_listHeight=0;_centerX=0;_centerY=0;_imgData=[];_listElem=p;var n=d(_listElem).css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}).parent();var s=document.createElement("div");var r=document.createElement("p");d(r).addClass("bf-caption").css({backgroundColor:k.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(k.imagePadding+10)+"px 15px",position:"absolute"});d(s).addClass("bf-wrapper").css({position:"relative"}).append(_listElem).append(r);n.append(s);d(window).resize(function(){_listWidth=d(document.body).width();_centerX=_listWidth*0.5;f();m(_activeElem)});var q=d(_listElem).children();var o=false;q.each(function(v){var u=d(this).find("img");if(k.forceWidth){u.width(k.forceWidth)}var t=l(u.get(0));var w=g(u,t);_imgData.push(w);a(u,v);if(v===_activeIndex&&t){o=w.h}c(this,v)});_listWidth=d(document.body).width();_centerX=_listWidth*0.5;if(o){_centerY=k.thumbTopOffset==="auto"?o*0.5:k.thumbTopOffset}else{_centerY=k.thumbTopOffset==="auto"?_listHeight*0.5:k.thumbTopOffset+k.thumbHeight*0.5}if(k.enableKeyNavigation){d(document).keydown(function(t){if(t.keyCode===37){h(-1)}else{if(t.keyCode===39){h(1)}}})}f()};var c=function(o,n){d(o).css({backgroundColor:k.backgroundColor,position:"absolute",textAlign:"center"}).find("img").css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"});if(!_activeElem&&k.activeIndex===n){d(o).addClass("active");_activeElem=o;_activeIndex=n}_elCounter++};var f=function(p){var r=true;var o,s,w,t,v=0;var u=null;var n=function(){m(_activeElem);if(d(document.body).width()!==_listWidth){_listWidth=d(document.body).width();_centerX=_listWidth*0.5;f();m(_activeElem)}};var q={};d(_listElem).children().each(function(x){if(d(this).hasClass("active")){q={left:(_centerX-k.imagePadding-_imgData[x].w*0.5)+"px",top:"0",width:_imgData[x].w+"px",height:_imgData[x].h+"px",padding:k.imagePadding+"px"};r=false;u=n}else{q={left:(r?(_centerX-k.imagePadding-_imgData[_activeIndex].w*0.5+(x-_activeIndex)*_imgData[x].tw+(x-1-_activeIndex)*10):(_centerX+k.imagePadding+_imgData[_activeIndex].w*0.5+(x-_activeIndex-1)*_imgData[x].tw+(x-_activeIndex)*10))+"px",top:(_centerY-_imgData[x].th*0.5)+"px",width:_imgData[x].tw+"px",height:_imgData[x].th+"px",padding:k.thumbPadding+"px"};u=null}if(p){d(this).stop().animate(q,{duration:k.duration,easing:k.easing,complete:u})}else{d(this).css(q);if(u){u()}}})};var m=function(q){var p=d(q).find("img").get(0);if(!l(p)){return false}var o=d(q).parent().parent().find("p.bf-caption");var r=p.title;if(p.title.length>0){o.text(r);o.css({left:_centerX-k.imagePadding-_imgData[_activeIndex].w*0.5,top:_imgData[_activeIndex].h+k.imagePadding*2,width:_imgData[_activeIndex].w-20});var n=d(_listElem).height()+o.height()+40;d(_listElem).parent().height(n);o.fadeIn("fast")}};var g=function(q,o){o=o||false;var p,n,t=0;if(o){var s=q.get(0);if(typeof s.naturalWidth!=="undefined"){p=k.forceWidth||q.attr("naturalWidth")||q.attr("width");n=k.forceHeight||q.attr("naturalHeight")||q.attr("height")}else{var r=new Image();r.src=q.attr("src");p=r.width;n=r.height}t=k.thumbHeight==="auto"?Math.round(n*Number(k.thumbWidth)/p):k.thumbHeight}else{t=k.thumbHeight==="auto"?50:k.thumbHeight;n=t;p=k.thumbWidth}j(n);return{h:n,w:p,th:t,tw:k.thumbWidth}};var l=function(n){if((k.forceWidth&&k.forceHeight)||(n.width>k.thumbWidth&&n.height>20)){return true}if(!n.complete){return false}if(typeof n.naturalWidth!=="undefined"&&n.naturalWidth===0){return false}return true};var a=function(n,o){n.hide().parent().addClass(k.loadingClass).css({height:_imgData[o].th,width:_imgData[o].tw});var p=function(s){if(this.complete||(this.readyState==="complete"&&s.type==="readystatechange")){d(this).css("visibility","visible").parent().removeClass(k.loadingClass);d(this).fadeIn();var r=g(n,true);_imgData[o]=r;if(o===k.activeIndex){_activeLoaded=true;_centerY=k.thumbTopOffset==="auto"?r.h*0.5:k.thumbTopOffset;if(s){f()}}else{var t={height:r.th};if(_activeLoaded){t.top=(_centerY-_imgData[o].th*0.5)+"px"}n.parent().animate(t)}i(n.parent())}};var q=n.get(0);if(q.complete){p.call(q)}else{n.bind("load readystatechange",p).bind("error",function(){d(this).css("visibility","visible").parent().removeClass(k.loadingClass)})}};var i=function(n){d(n).click(function(){if(this!==_activeElem){d("p.bf-caption").hide();_activeIndex=0;_activeElem=this;d(this).parent().children().each(function(o){if(_activeElem===this){_activeIndex=o}});e();f(k.animate)}})};var h=function(n){if(n<0&&_activeIndex>0){_activeIndex+=n}else{if(n>0&&_activeIndex<_imgData.length-1){_activeIndex+=n}else{return false}}_activeElem=d(_listElem).children().get(_activeIndex);e();f(k.animate)};var e=function(n){d("p.bf-caption").hide();d(_listElem).find(".active").removeClass("active");d(_activeElem).addClass("active");_listWidth=d(document.body).width();_centerX=_listWidth*0.5};var j=function(n){if(n>_listHeight){_listHeight=n;_listHeight+=k.imagePadding*2;d(_listElem).height(_listHeight)}}})(jQuery);