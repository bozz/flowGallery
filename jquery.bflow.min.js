/*
 * jQuery bFlow plugin: Simple Cover Flow Plugin
 * Examples and documentation at: http://github.com/bozz/jquery-bflow
 * version 0.5.0 (14-JAN-2011)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(e){e.fn.bflow=function(v){j=e.extend(e.fn.bflow.defaults,v);return this.each(function(w){a(this)})};e.fn.bflow.defaults={activeIndex:0,animate:true,forceWidth:false,forceHeight:false,backgroundColor:"black",thumbWidth:100,thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,loadingClass:"loading",easing:"linear",duration:"slow"};var j={};var s=0;var i=0;var n=false;var d=false;var k=false;var u=0;var g=0;var r=0;var q=0;var f=[];var a=function(x){k=x;var v=e(k).css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}).parent();var A=document.createElement("div");var z=document.createElement("p");e(z).addClass("bf-caption").css({backgroundColor:j.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(j.imagePadding+10)+"px 15px",position:"absolute"});e(A).addClass("bf-wrapper").css({position:"relative"}).append(k).append(z);v.append(A);e(window).resize(function(){u=e(document.body).width();r=u*0.5;p();l(n)});var y=e(k).children();var w=false;y.each(function(D){var C=e(this).find("img");if(j.forceWidth){C.width(j.forceWidth)}var B=h(C.get(0));var E=t(C,B);f.push(E);c(C,D);if(D===i&&B){w=E.h}o(this,D)});u=e(document.body).width();r=u*0.5;if(w){q=j.thumbTopOffset==="auto"?w*0.5:j.thumbTopOffset}else{q=j.thumbTopOffset==="auto"?g*0.5:j.thumbTopOffset+j.thumbHeight*0.5}p()};var o=function(w,v){e(w).css({backgroundColor:j.backgroundColor,position:"absolute",textAlign:"center"}).find("img").css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"});if(!n&&j.activeIndex===v){e(w).addClass("active");n=w;i=v}s++};var p=function(x){var z=true;var w,A,E,B,D=0;var C=null;var v=function(){l(n);if(e(document.body).width()!==u){u=e(document.body).width();r=u*0.5;p();l(n)}};var y={};e(k).children().each(function(F){if(e(this).hasClass("active")){y={left:(r-j.imagePadding-f[F].w*0.5)+"px",top:"0",width:f[F].w+"px",height:f[F].h+"px",padding:j.imagePadding+"px"};z=false;C=v}else{y={left:(z?(r-j.imagePadding-f[i].w*0.5+(F-i)*f[F].tw+(F-1-i)*10):(r+j.imagePadding+f[i].w*0.5+(F-i-1)*f[F].tw+(F-i)*10))+"px",top:(q-f[F].th*0.5)+"px",width:f[F].tw+"px",height:f[F].th+"px",padding:"3px"};C=null}if(x){e(this).stop().animate(y,{duration:j.duration,easing:j.easing,complete:C})}else{e(this).css(y);if(C){C()}}})};var l=function(y){var x=e(y).find("img").get(0);if(!h(x)){return false}var w=e(y).parent().parent().find("p.bf-caption");var z=x.title;w.text(z);w.css({left:r-j.imagePadding-f[i].w*0.5,top:f[i].h+j.imagePadding*2,width:f[i].w-20});var v=e(k).height()+w.height()+40;e(k).parent().height(v);w.fadeIn("fast")};var t=function(y,w){w=w||false;var x,v,B=0;if(w){var A=y.get(0);if(typeof A.naturalWidth!=="undefined"){x=j.forceWidth||y.attr("naturalWidth")||y.attr("width");v=j.forceHeight||y.attr("naturalHeight")||y.attr("height")}else{var z=new Image();z.src=y.attr("src");x=z.width;v=z.height}B=j.thumbHeight==="auto"?Math.round(v*Number(j.thumbWidth)/x):j.thumbHeight}else{B=j.thumbHeight==="auto"?50:j.thumbHeight;v=B;x=j.thumbWidth}b(v);return{h:v,w:x,th:B,tw:j.thumbWidth}};var h=function(v){if((j.forceWidth&&j.forceHeight)||(v.width>j.thumbWidth&&v.height>20)){return true}if(!v.complete){return false}if(typeof v.naturalWidth!=="undefined"&&v.naturalWidth===0){return false}return true};var c=function(v,w){v.hide().parent().addClass(j.loadingClass).css({height:f[w].th,width:f[w].tw});v.bind("load readystatechange",function(y){if(this.complete||(this.readyState==="complete"&&y.type==="readystatechange")){e(this).css("visibility","visible").parent().removeClass(j.loadingClass);e(this).fadeIn();var x=t(v,true);f[w]=x;if(w===i){d=true;q=j.thumbTopOffset==="auto"?x.h*0.5:j.thumbTopOffset;p()}else{var z={height:x.th};if(d){z.top=(q-f[w].th*0.5)+"px"}v.parent().animate(z)}m(v.parent())}}).bind("error",function(){e(this).css("visibility","visible").parent().removeClass(j.loadingClass)})};var m=function(v){e(v).click(function(){if(this!==n){e("p.bf-caption").hide();i=0;n=this;e(this).parent().children().each(function(w){if(n===this){i=w}});e(k).children().stop();e(k).find(".active").removeClass("active");e(this).addClass("active");u=e(document.body).width();r=u*0.5;p(j.animate)}})};var b=function(v){if(v>g){g=v;g+=j.imagePadding*2;e(k).height(g)}}})(jQuery);