/*!
 * jQuery flowgallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowgallery
 * Version: 0.7.0pre (21-FEB-2012)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(a,b,c,d){var e=function(){return"1.0.0pre"},f=function(){function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}function f(a,c){b[a]&&(c["get"+e(a)]=function(){return b[a]})}function g(a,c){b[a]&&(c["set"+e(a)]=function(c){b[a]=c})}function h(e,h){e._getSource=function(){return b};if(h.getters){d=h.getters.length;for(c=0;c<d;c++)f(h.getters[c],e)}if(h.setters){d=h.setters.length;for(c=0;c<d;c++)g(h.setters[c],e)}if(h.methods){d=h.methods.length;for(c=0;c<d;c++)method=h.methods[c],b[method]&&(e[method]=a.proxy(b[method],b))}h.version&&(e._version=h.version)}var b,c,d;return{init:function(a,c){return function(){if(typeof a=="function"){var e=Array.prototype.slice.call(arguments),f,g,i=function(){};return i.prototype=a.prototype,f=new i,g=a.apply(f,e),b=typeof g=="object"?g:f,h(this,c),this}}}}}(),g=function(b,c){this.list=b,this.$list=a(b),this.options=c,this.metadata=this.$list.data("plugin-options"),this.listWidth=0,this.listHeight=0,this.elCounter=0,this.flowItems=[],this.activeLoaded=!1,this.centerX=0,this.centerY=0,this.$container=!1,this.$caption=!1,this.config={},this.length=0,this.activeIndex=0,this.activeItem=!1,this.enabled=!0,this.init()};g.defaults={activeIndex:0,animate:!0,circular:!1,enableKeyNavigation:!0,forwardOnActiveClick:!1,forceWidth:!1,forceHeight:!1,backgroundColor:"black",loadingWidth:100,loadingHeight:60,thumbWidth:"auto",thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:0,thumbPadding:0,loadingClass:"loading",easing:"linear",duration:900},g.prototype={constructor:g,init:function(){this.config=a.extend({},g.defaults,this.options,this.metadata),this.$container=this.$list.parent(),this.length=this.$list.children().length,this.initDom(),this.initFlowItems(),this.$list.css("visibility","visible"),a(b).resize(a.proxy(this.windowResizeHandler,this));if(this.config.enableKeyNavigation===!0){var d=a.proxy(this.handleKeyEvents,this);a(c).keydown(d)}this.updateFlow(!1)},next:function(){return this.flowInDir(1),this},prev:function(){return this.flowInDir(-1),this},"goto":function(a){return this.flowInDir(a-this.activeIndex),this},disable:function(){return this.enabled=!1,this},enable:function(){return this.enabled=!0,this},initDom:function(){this.$list.css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}),this.initCaption(),this.initWrapper()},initCaption:function(){var b=c.createElement("p");this.$caption=a(b).addClass("fg-caption").css({backgroundColor:this.config.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(this.config.imagePadding+10)+"px 15px",position:"absolute"})},initWrapper:function(){var b=c.createElement("div");a(b).addClass("fg-wrapper").css({position:"relative"}).append(this.$list.get(0)).append(this.$caption.get(0)),this.$container.append(b)},initFlowItems:function(){var b=this;this.$list.children().each(function(c){var d=new i(this,c,b,a.proxy(b.itemLoadedHandler,b));b.flowItems.push(d),d.init()}),this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5;var c=!1;this.activeItem.isLoaded&&(c=this.activeItem.h),c?centerY=this.config.thumbTopOffset==="auto"?c*.5:this.config.thumbTopOffset:centerY=this.config.thumbTopOffset==="auto"?this.listHeight*.5:this.config.thumbTopOffset+this.config.thumbHeight*.5},itemLoadedHandler:function(a){if(a.index===this.config.activeIndex)this.activeLoaded=!0,this.centerY=this.config.thumbTopOffset==="auto"?a.h*.5:this.config.thumbTopOffset;else{var b={height:a.th,width:a.tw};this.activeLoaded&&(b.top=this.centerY-a.th*.5+"px"),a.getListItem().animate(b)}this.updateListHeight(a.h),this.updateFlow()},afterFlowHandler:function(){this.showCaption(),this.$container.width()!==this.listWidth&&(this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5,this.updateFlow(),this.showCaption())},getOldActiveAfterFlowHandler:function(a){var b=this;return function(){var c=b.flowItems[a];c.oldActive=!1}},updateFlow:function(b){if(!this.enabled)return!1;var c={},d=!0,e=null,f=!1,g=!1,h=this.flowItems.length,i;for(i=0;i<h;i++)f=this.flowItems[i],this.$listItem=f.getListItem(),this.$listItem.hasClass("active")?(c={left:this.centerX-this.config.imagePadding-f.w*.5+"px",top:"0",width:f.w+"px",height:f.h+"px",padding:this.config.imagePadding+"px"},d=!1,e=a.proxy(this.afterFlowHandler,this)):(c={left:this.calculateLeftPosition(i,d),top:this.centerY-f.th*.5+"px"},e=null,f.oldActive&&(c.width=f.tw+"px",c.height=f.th+"px",c.padding=this.config.thumbPadding+"px",e=this.getOldActiveAfterFlowHandler(i))),b?this.$listItem.stop().animate(c,{duration:this.config.duration,easing:this.config.easing,complete:e}):(this.$listItem.css(c),e&&e())},flowInDir:function(a){if(!this.enabled)return!1;var b=this.activeIndex+a;if(b>this.flowItems.length-1||b<0)return!1;this.activeItem.oldActive=!0;if(a<0&&this.activeIndex>0)this.flowItems[this.activeIndex].oldActive=!0,this.activeIndex+=a;else if(a>0&&this.activeIndex<this.flowItems.length-1)this.activeIndex+=a;else return!1;this.activeItem=this.flowItems[this.activeIndex],this.prepareFlow(),this.updateFlow(this.config.animate)},prepareFlow:function(){this.$caption.hide(),this.$list.find(".active").removeClass("active"),a(this.activeItem.getListItem()).addClass("active"),this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5},calculateLeftPosition:function(a,b){var c=this.centerX,d=0;if(b){c-=this.flowItems[this.activeIndex].w*.5,c-=this.config.imagePadding,c-=(this.activeIndex-a)*10,c-=(this.activeIndex-a)*2*this.config.thumbPadding;for(d=a;d<this.activeIndex;d++)c-=this.flowItems[d].tw}else{c+=this.flowItems[this.activeIndex].w*.5,c+=this.config.imagePadding,c+=(a-this.activeIndex)*10,c+=(a-this.activeIndex)*2*this.config.thumbPadding;for(d=this.activeIndex+1;d<a;d++)c+=this.flowItems[d].tw}return c+"px"},windowResizeHandler:function(){this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5,this.updateFlow(),this.showCaption()},showCaption:function(){if(!this.activeItem.isLoaded)return!1;var a=this.activeItem.captionText;if(a&&a.length>0){this.$caption.text(a),this.$caption.css({left:this.centerX-this.config.imagePadding-this.activeItem.w*.5,top:this.activeItem.h+this.config.imagePadding*2,width:this.activeItem.w-20});var b=this.activeItem.h+this.$caption.height()+40;this.$list.height(b),this.$caption.fadeIn("fast")}},updateListHeight:function(a){a>this.listHeight&&(this.listHeight=a,this.listHeight+=this.config.imagePadding*2,this.$list.height(this.listHeight))},handleKeyEvents:function(a){if(!this.enabled)return!1;a.keyCode===37?this.flowInDir(-1):a.keyCode===39&&this.flowInDir(1)}};var h=f.init(g,{getters:["options","length"],methods:["next","prev","goto","enable","disable"],version:e()}),i=function(b,c,d,e){this.listItem=b,this.$listItem=a(b),this.index=c,this.flowGallery=d,this.config=d.config,this.loadCompleteCallback=e,this.h=0,this.th=0,this.w=0,this.tw=0,this.active=!1,this.isLoaded=!1,this.captionText=!1,this.oldActive=!1,this.$img=!1};i.prototype={getListItem:function(){return this.$listItem},init:function(){this.h=this.config.loadingHeight,this.th=this.config.loadingHeight,this.w=this.config.loadingWidth,this.tw=this.config.loadingWidth,this.$img=this.$listItem.find("img"),this.captionText=this.$img.attr("title"),this.config.forceWidth&&this.$img.width(this.config.forceWidth),this.$img.hide().parent().addClass(this.config.loadingClass).css({height:this.th,width:this.tw}),this.addLoadHandler(),this.$listItem.css({backgroundColor:this.config.backgroundColor,padding:this.config.thumbPadding,position:"absolute",textAlign:"center"}),this.$img.css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"}),!this.flowGallery.activeItem&&this.config.activeIndex===this.index&&(this.$listItem.addClass("active"),this.flowGallery.activeItem=this,this.flowGallery.activeIndex=this.index)},addLoadHandler:function(){var b=this.$img.get(0);if(b.complete)this.initListItem();else{var c=this;this.$img.bind("load readystatechange",a.proxy(this.imageLoadHandler,this)).bind("error",function(){c.$img.css("visibility","visible").parent().removeClass(c.config.loadingClass)})}},imageLoadHandler:function(a){var b=this.$img.get(0);(b.complete||b.readyState==="complete"&&a.type==="readystatechange")&&this.initListItem()},initListItem:function(){this.$img.css("visibility","visible").parent().removeClass(this.config.loadingClass),this.$img.fadeIn(),this.isLoaded=!0,this.initImageDimensions(),this.$listItem.click(a.proxy(this.clickHandler,this)),typeof this.loadCompleteCallback=="function"&&this.loadCompleteCallback(this)},initImageDimensions:function(){var a=this.$img.get(0);if(typeof a.naturalWidth!="undefined")this.w=this.config.forceWidth||a.naturalWidth||a.width,this.h=this.config.forceHeight||a.naturalHeight||a.height;else{var b=new Image;b.src=this.$img.attr("src"),this.w=b.width,this.h=b.height}this.config.thumbWidth==="auto"&&this.config.thumbHeight==="auto"?(this.tw=this.config.loadingWidth,this.th=Math.round(this.h*this.config.loadingWidth/this.w)):this.config.thumbHeight==="auto"?(this.tw=this.config.thumbWidth,this.th=Math.round(this.h*Number(this.config.thumbWidth)/this.w)):this.config.thumbWidth==="auto"?(this.tw=Math.round(this.w*Number(this.config.thumbHeight)/this.h),this.th=this.config.thumbHeight):(this.tw=this.config.thumbWidth,this.th=this.config.thumbHeight)},clickHandler:function(){if(this.listItem!==this.flowGallery.activeItem){var a=this.flowGallery.activeIndex;this.flowGallery.flowInDir(this.index-a)}else this.config.forwardOnActiveClick===!0&&this.flowGallery.flowInDir(1)},isSizeReady:function(){if(this.isLoaded)return!0;var a=$img.get(0);return flowGallery.config.forceWidth&&flowGallery.config.forceHeight||a.width>flowGallery.config.thumbWidth&&a.height>20?!0:a.complete?typeof a.naturalWidth!="undefined"&&a.naturalWidth===0?!1:!0:!1}},a.fn.flowgallery=function(b){return this.each(function(){var c=a(this);if(c.data("flowgallery"))return;var d=new h(this,b);c.data("flowgallery",d)})},a.fn.flowgallery.defaults={activeIndex:0,animate:!0,circular:!1,enableKeyNavigation:!0,forwardOnActiveClick:!1,forceWidth:!1,forceHeight:!1,backgroundColor:"black",loadingWidth:100,loadingHeight:60,thumbWidth:"auto",thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:0,thumbPadding:0,loadingClass:"loading",easing:"linear",duration:900}})(jQuery,window,document)