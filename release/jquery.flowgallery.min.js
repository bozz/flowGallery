/*!
 * jQuery flowgallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowgallery
 * Version: 1.0.0pre (01-FEB-2012)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(a){var b=function(){return"1.0.0pre"},c=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},d=function(b){var d={},e;if(b.src){var f=b.src;d._getSource=function(){return b.src};if(b.getters){var g=function(a){d["get"+c(a)]=function(){return f[a]}};for(e=0;e<b.getters.length;e++)g(b.getters[e])}if(b.setters){var h=function(a){d["set"+c(a)]=function(b){f[a]=b}};for(e=0;e<b.setters.length;e++)h(b.setters[e])}if(b.methods)for(e=0;e<b.methods.length;e++)method=b.methods[e],d[method]=a.proxy(b.src[method],b.src);b.version&&(d._version=b.version)}return d},e=function(c,e){a.extend(this,d({src:new f(c,e),getters:["options","length"],methods:["next","prev","goto"],version:b()}))},f=function(b,c){var d=a(b),e=d.parent(),f=0,h=0,i=!1,j=0,k=[],l=!1,m=0,n=0,o=this;this.options=a.extend({},a.fn.flowgallery.defaults,c),this.length=d.children().length,this.activeIndex=0,this.activeElem=!1,this.next=function(){o.flowInDir(1)},this.prev=function(){o.flowInDir(-1)},this.goto=function(a){o.flowInDir(a-o.activeIndex)};var p=function(){q(),t(),d.css("visibility","visible"),a(window).resize(A),o.options.enableKeyNavigation===!0&&a(document).unbind("keydown",D).keydown(D),x(!1)},q=function(){d.css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}),r(),s()},r=function(){var b=document.createElement("p");i=a(b).addClass("bf-caption").css({backgroundColor:o.options.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(o.options.imagePadding+10)+"px 15px",position:"absolute"})},s=function(){var b=document.createElement("div");a(b).addClass("bf-wrapper").css({position:"relative"}).append(d.get(0)).append(i.get(0)),e.append(b)},t=function(){d.children().each(function(a){k.push(new g(this,a,o,u))}),f=e.width(),m=f*.5;var a=!1;o.activeElem.isLoaded&&(a=o.activeElem.h),a?n=o.options.thumbTopOffset==="auto"?a*.5:o.options.thumbTopOffset:n=o.options.thumbTopOffset==="auto"?h*.5:o.options.thumbTopOffset+o.options.thumbHeight*.5},u=function(a){if(a.index===o.options.activeIndex)l=!0,n=o.options.thumbTopOffset==="auto"?a.h*.5:o.options.thumbTopOffset;else{var b={height:a.th,width:a.tw};l&&(b.top=n-a.th*.5+"px"),a.getListItem().animate(b)}C(a.h),x()},v=function(){B(),e.width()!==f&&(f=e.width(),m=f*.5,x(),B())},w=function(a){return function(){var b=k[a];b.oldActive=!1}},x=function(a){var b={},c=!0,d=null,e=!1,f=!1,g=k.length;for(var h=0;h<g;h++)e=k[h],f=e.getListItem(),f.hasClass("active")?(b={left:m-o.options.imagePadding-e.w*.5+"px",top:"0",width:e.w+"px",height:e.h+"px",padding:o.options.imagePadding+"px"},c=!1,d=v):(b={left:z(h,c),top:n-e.th*.5+"px"},d=null,e.oldActive&&(b.width=e.tw+"px",b.height=e.th+"px",b.padding=o.options.thumbPadding+"px",d=w(h))),a?f.stop().animate(b,{duration:o.options.duration,easing:o.options.easing,complete:d}):(f.css(b),d&&d())};this.flowInDir=function(a){var b=o.activeIndex+a;if(b>k.length-1||b<0)return!1;o.activeElem.oldActive=!0;if(a<0&&o.activeIndex>0)k[o.activeIndex].oldActive=!0,o.activeIndex+=a;else if(a>0&&o.activeIndex<k.length-1)o.activeIndex+=a;else return!1;o.activeElem=k[o.activeIndex],y(),x(o.options.animate)};var y=function(){i.hide(),d.find(".active").removeClass("active"),a(o.activeElem.getListItem()).addClass("active"),f=e.width(),m=f*.5},z=function(a,b){var c=m,d=0;if(b){c-=k[o.activeIndex].w*.5,c-=o.options.imagePadding,c-=(o.activeIndex-a)*10,c-=(o.activeIndex-a)*2*o.options.thumbPadding;for(d=a;d<o.activeIndex;d++)c-=k[d].tw}else{c+=k[o.activeIndex].w*.5,c+=o.options.imagePadding,c+=(a-o.activeIndex)*10,c+=(a-o.activeIndex)*2*o.options.thumbPadding;for(d=o.activeIndex+1;d<a;d++)c+=k[d].tw}return c+"px"},A=function(){f=e.width(),m=f*.5,x(),B()},B=function(){var a=o.activeElem;if(!a.isLoaded)return!1;var b=a.captionText;if(b&&b.length>0){i.text(b),i.css({left:m-o.options.imagePadding-a.w*.5,top:a.h+o.options.imagePadding*2,width:a.w-20});var c=a.h+i.height()+40;d.height(c),i.fadeIn("fast")}},C=function(a){a>h&&(h=a,h+=o.options.imagePadding*2,d.height(h))},D=function(a){a.keyCode===37?o.flowInDir(-1):a.keyCode===39&&o.flowInDir(1)};p()},g=function(b,c,d,e){this.h,this.th=d.options.loadingHeight,this.w,this.tw=d.options.loadingWidth,this.index=c,this.active=!1,this.isLoaded=!1,this.captionText=!1,this.oldActive=!1;var f=this,g=a(b),h=!1;this.getListItem=function(){return g},this.bind=function(a,b){g.bind(a,b)};var i=function(){h=g.find("img"),f.captionText=h.attr("title"),d.options.forceWidth&&h.width(d.options.forceWidth),h.hide().parent().addClass(d.options.loadingClass).css({height:f.th,width:f.tw}),j(),g.css({backgroundColor:d.options.backgroundColor,padding:d.options.thumbPadding,position:"absolute",textAlign:"center"}),h.css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"}),!d.activeElem&&d.options.activeIndex===c&&(g.addClass("active"),d.activeElem=f,d.activeIndex=c)},j=function(){var b=h.get(0);b.complete?k.call(b):h.bind("load readystatechange",k).bind("error",function(){a(this).css("visibility","visible").parent().removeClass(d.options.loadingClass)})},k=function(a){if(this.complete||this.readyState==="complete"&&a.type==="readystatechange")h.css("visibility","visible").parent().removeClass(d.options.loadingClass),h.fadeIn(),f.isLoaded=!0,l(),g.click(m),k&&e(f)},l=function(){var a=d.options,b=h.get(0);if(typeof b.naturalWidth!="undefined")f.w=a.forceWidth||b.naturalWidth||b.width,f.h=a.forceHeight||b.naturalHeight||b.height;else{var c=new Image;c.src=h.attr("src"),f.w=c.width,f.h=c.height}a.thumbWidth==="auto"&&a.thumbHeight=="auto"?(f.tw=a.loadingWidth,f.th=Math.round(f.h*a.loadingWidth/f.w)):a.thumbHeight==="auto"?(f.tw=d.options.thumbWidth,f.th=Math.round(f.h*Number(a.thumbWidth)/f.w)):a.thumbWidth==="auto"?(f.tw=Math.round(f.w*Number(a.thumbHeight)/f.h),f.th=a.thumbHeight):(f.tw=a.thumbWidth,f.th=a.thumbHeight,console.log("h/w::: ",f.th,f.tw))},m=function(){if(f!==d.activeElem){var a=d.activeIndex;d.flowInDir(c-a)}else d.options.forwardOnActiveClick===!0&&d.flowInDir(1)},n=function(){if(f.isLoaded)return!0;var a=h.get(0);return d.options.forceWidth&&d.options.forceHeight||a.width>d.options.thumbWidth&&a.height>20?!0:a.complete?typeof a.naturalWidth!="undefined"&&a.naturalWidth===0?!1:!0:!1};i()};a.fn.flowgallery=function(b){return this.each(function(){var c=a(this);if(c.data("flowgallery"))return;var d=new e(this,b);c.data("flowgallery",d)})},a.fn.flowgallery.defaults={activeIndex:0,animate:!0,circular:!1,enableKeyNavigation:!0,forwardOnActiveClick:!1,forceWidth:!1,forceHeight:!1,backgroundColor:"black",loadingWidth:100,loadingHeight:60,thumbWidth:"auto",thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:0,thumbPadding:0,loadingClass:"loading",easing:"linear",duration:900}})(jQuery)