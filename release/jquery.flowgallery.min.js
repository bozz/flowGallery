/*!
 * jQuery flowgallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowgallery
 * Version: 1.0.0pre (06-JAN-2012)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
(function(a){var b=function(b,d){var e=a(b),f=e.parent(),g=0,h=0,i=!1,j=0,k=[],l=this;this.options=a.extend(a.fn.flowgallery.defaults,d),this.activeIndex=0,this.activeElem=!1,this.activeLoaded=!1,this.centerX=0,this.centerY=0,console.log("creating FlowGallery: ",this.options.name);var m=function(){n(),q(),a(window).resize(t),l.options.enableKeyNavigation!==!0,l.updateFlow(!1)},n=function(){e.css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}),o(),p()},o=function(){var b=document.createElement("p");i=a(b).addClass("bf-caption").css({backgroundColor:l.options.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(l.options.imagePadding+10)+"px 15px",position:"absolute"})},p=function(){var b=document.createElement("div");a(b).addClass("bf-wrapper").css({position:"relative"}).append(e.get(0)).append(i.get(0)),f.append(b)},q=function(){e.children().each(function(a){k.push(new c(this,a,l))}),g=f.width(),l.centerX=g*.5;var a=!1;l.activeElem.isLoaded&&(a=l.activeElem.h),a?l.centerY=l.options.thumbTopOffset==="auto"?a*.5:l.options.thumbTopOffset:l.centerY=l.options.thumbTopOffset==="auto"?h*.5:l.options.thumbTopOffset+l.options.thumbHeight*.5};afterFlowHandler=function(){u(),f.width()!==g&&(g=f.width(),l.centerX=g*.5,l.updateFlow(),u())},getOldActiveAfterFlowHandler=function(a){return function(){var b=k[a];b.oldActive=!1}},this.updateFlow=function(a){var b={},c=!0,d=null,e=!1,f=!1,g=k.length;for(var h=0;h<g;h++)e=k[h],f=e.getListItem(),f.hasClass("active")?(b={left:l.centerX-l.options.imagePadding-e.w*.5+"px",top:"0",width:e.w+"px",height:e.h+"px",padding:l.options.imagePadding+"px"},c=!1,d=afterFlowHandler):(b={left:s(h,c),top:l.centerY-e.th*.5+"px"},d=null,e.oldActive&&(b.width=e.tw+"px",b.height=e.th+"px",b.padding=l.options.thumbPadding+"px",d=getOldActiveAfterFlowHandler(h))),a?f.stop().animate(b,{duration:l.options.duration,easing:l.options.easing,complete:d}):(f.css(b),d&&d())},this.flowInDir=function(a){l.activeElem.oldActive=!0;if(a<0&&l.activeIndex>0)k[l.activeIndex].oldActive=!0,l.activeIndex+=a;else if(a>0&&l.activeIndex<k.length-1)l.activeIndex+=a;else return!1;l.activeElem=k[l.activeIndex],r(),l.updateFlow(l.options.animate)};var r=function(){i.hide(),e.find(".active").removeClass("active"),a(l.activeElem.getListItem()).addClass("active"),g=f.width(),l.centerX=g*.5},s=function(a,b){var c=l.centerX,d=0;if(b){c-=k[l.activeIndex].w*.5,c-=l.options.imagePadding,c-=(l.activeIndex-a)*10,c-=(l.activeIndex-a)*2*l.options.thumbPadding;for(d=a;d<l.activeIndex;d++)c-=k[d].tw}else{c+=k[l.activeIndex].w*.5,c+=l.options.imagePadding,c+=(a-l.activeIndex)*10,c+=(a-l.activeIndex)*2*l.options.thumbPadding;for(d=l.activeIndex+1;d<a;d++)c+=k[d].tw}return c+"px"},t=function(){g=f.width(),centerX=g*.5,l.updateFlow(),u()},u=function(){var a=l.activeElem;if(!a.isLoaded)return!1;var b=a.captionText;if(b.length>0){i.text(b),i.css({left:l.centerX-l.options.imagePadding-a.w*.5,top:a.h+l.options.imagePadding*2,width:a.w-20});var c=a.h+i.height()+40;e.height(c),i.fadeIn("fast")}};this.updateListHeight=function(a){a>h&&(h=a,h+=l.options.imagePadding*2,e.height(h))},m()},c=function(b,c,d){this.h,this.th=d.options.loadingHeight,this.w,this.tw=d.options.loadingWidth,this.active=!1,this.isLoaded=!1,this.captionText=!1,this.oldActive=!1;var e=this,f=a(b),g=!1;this.getListItem=function(){return f};var h=function(){g=f.find("img"),e.captionText=g.attr("title"),d.options.forceWidth&&g.width(d.options.forceWidth),g.hide().parent().addClass(d.options.loadingClass).css({height:e.th,width:e.tw}),i(),f.css({backgroundColor:d.options.backgroundColor,padding:d.options.thumbPadding,position:"absolute",textAlign:"center"}),g.css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"}),!d.activeElem&&d.options.activeIndex===c&&(f.addClass("active"),d.activeElem=e,d.activeIndex=c)},i=function(){var b=g.get(0);b.complete?j.call(b):g.bind("load readystatechange",j).bind("error",function(){a(this).css("visibility","visible").parent().removeClass(d.options.loadingClass)})},j=function(a){if(this.complete||this.readyState==="complete"&&a.type==="readystatechange"){g.css("visibility","visible").parent().removeClass(d.options.loadingClass),g.fadeIn(),e.isLoaded=!0,k();if(c===d.options.activeIndex)d.activeLoaded=!0,d.centerY=d.options.thumbTopOffset==="auto"?e.h*.5:d.options.thumbTopOffset,a&&d.updateFlow();else{var b={height:e.th,width:e.tw};d.activeLoaded&&(b.top=d.centerY-e.th*.5+"px"),f.animate(b)}f.click(l),d.updateFlow()}},k=function(){var a=d.options,b=g.get(0);if(typeof b.naturalWidth!="undefined")e.w=a.forceWidth||b.naturalWidth||b.width,e.h=a.forceHeight||b.naturalHeight||b.height;else{var c=new Image;c.src=g.attr("src"),e.w=c.width,e.h=c.height}a.thumbWidth==="auto"&&a.thumbHeight=="auto"?(e.tw=a.loadingWidth,e.th=Math.round(e.h*a.loadingWidth/e.w)):a.thumbHeight==="auto"?(e.tw=d.options.thumbWidth,e.th=Math.round(e.h*Number(a.thumbWidth)/e.w)):a.thumbWidth==="auto"?(e.tw=Math.round(e.w*Number(a.thumbHeight)/e.h),e.th=a.thumbHeight):(e.tw=a.thumbWidth,e.th=a.thumbHeight),d.updateListHeight(e.h)},l=function(){if(e!==d.activeElem){var a=d.activeIndex;d.flowInDir(c-a)}else d.options.forwardOnActiveClick===!0&&d.flowInDir(1)},m=function(){if(e.isLoaded)return!0;var a=g.get(0);return d.options.forceWidth&&d.options.forceHeight||a.width>d.options.thumbWidth&&a.height>20?!0:a.complete?typeof a.naturalWidth!="undefined"&&a.naturalWidth===0?!1:!0:!1};h()};a.fn.flowgallery=function(c){return this.each(function(){var d=a(this);if(d.data("flowgallery"))return;var e=new b(this,c);d.data("flowgallery",e)})},a.fn.flowgallery.defaults={activeIndex:0,animate:!0,circular:!1,enableKeyNavigation:!0,forwardOnActiveClick:!1,forceWidth:!1,forceHeight:!1,backgroundColor:"black",loadingWidth:100,loadingHeight:60,thumbWidth:"auto",thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,thumbPadding:3,loadingClass:"loading",easing:"linear",duration:900}})(jQuery)