/*!
 * jQuery flowgallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://flowgallery.org
 * Version: 0.7.0pre (12-NOV-2012)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.4 or later
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(e,t,n,r){var i=function(){return"0.7.0pre"},s=function(){function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function s(e,n){t[e]&&(n["get"+i(e)]=function(){return t[e]})}function o(e,n){t[e]&&(n["set"+i(e)]=function(n){t[e]=n})}function u(i,u){i._getSource=function(){return t};if(u.getters){r=u.getters.length;for(n=0;n<r;n++)s(u.getters[n],i)}if(u.setters){r=u.setters.length;for(n=0;n<r;n++)o(u.setters[n],i)}if(u.methods){r=u.methods.length;for(n=0;n<r;n++)method=u.methods[n],t[method]&&(i[method]=e.proxy(t[method],t))}u.version&&(i._version=u.version)}var t,n,r;return{init:function(e,n){return function(){if(typeof e=="function"){var i=Array.prototype.slice.call(arguments),s,o,a=function(){};return a.prototype=e.prototype,s=new a,o=e.apply(s,i),t=typeof o=="object"?o:s,u(this,n),this}}}}}(),o=function(t,n){this.list=t,this.$list=e(t),this.config=n,this.metadata=this.$list.data("plugin-options"),this.options={},this.length=0,this.activeIndex=0,this.activeItem=!1,this.listWidth=0,this.listHeight=0,this.elCounter=0,this.flowItems=[],this.activeLoaded=!1,this.centerX=0,this.centerY=0,this.$container=!1,this.$caption=!1,this.enabled=!0,this.init()};o.defaults={activeIndex:0,animate:!0,backgroundColor:"black",circular:!1,duration:900,easing:"linear",enableKeyNavigation:!0,forceHeight:!1,forceWidth:!1,forwardOnActiveClick:!0,imagePadding:0,loadingClass:"loading",loadingHeight:60,loadingWidth:100,thumbHeight:"auto",thumbPadding:0,thumbTopOffset:"auto",thumbWidth:"auto"},o.prototype={constructor:o,init:function(){this.options=e.extend({},o.defaults,this.config,this.metadata),this.$container=this.$list.parent(),this.length=this.$list.children().length,this.initDom(),this.initFlowItems(),this.$list.css("visibility","visible"),e(t).resize(e.proxy(this.windowResizeHandler,this));if(this.options.enableKeyNavigation===!0){var r=e.proxy(this.handleKeyEvents,this);e(n).keydown(r)}this.updateFlow(!1)},next:function(e){return this.flowInDir(1,e),this},prev:function(e){return this.flowInDir(-1,e),this},jump:function(e,t){return this.flowInDir(e-this.activeIndex,t),this},isEnabled:function(){return this.enabled===!0},disable:function(){return this.enabled=!1,this},enable:function(){return this.enabled=!0,this.resizeWhileDisabled&&(e.proxy(this.windowResizeHandler,this)(),this.resizeWhileDisabled=!1),this},initDom:function(){this.$list.css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}),this.initCaption(),this.initWrapper()},initCaption:function(){var t=n.createElement("p");this.$caption=e(t).addClass("fg-caption").css({backgroundColor:this.options.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(this.options.imagePadding+10)+"px 15px",position:"absolute"})},initWrapper:function(){var t=n.createElement("div");e(t).addClass("fg-wrapper").css({position:"relative"}).append(this.$list.get(0)).append(this.$caption.get(0)),this.$container.append(t)},initFlowItems:function(){var t=this;this.$list.children().each(function(n){var r=new a(this,n,t,e.proxy(t.itemLoadedHandler,t));t.flowItems.push(r),r.init()}),this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5},itemLoadedHandler:function(e){if(e.index===this.options.activeIndex)this.activeLoaded=!0;else{var t={height:e.th,width:e.tw};this.activeLoaded&&(t.top=this.centerY-e.th*.5+"px"),e.getListItem().animate(t)}this.updateListHeight(e.h),this.updateFlow(!1)},afterFlowHandler:function(){this.showCaption(),this.$container.width()!==this.listWidth&&(this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5,this.updateFlow(),this.showCaption())},getOldActiveAfterFlowHandler:function(e){var t=this;return function(){var n=t.flowItems[e];n.oldActive=!1}},updateFlow:function(t){if(!this.isEnabled())return!1;var n={},r=!0,i=null,s=!1,o=!1,u=this.flowItems.length;this.centerY=this.options.thumbTopOffset==="auto"?this.activeItem.h*.5:this.options.thumbTopOffset;var a;for(a=0;a<u;a++)s=this.flowItems[a],this.$listItem=s.getListItem(),this.$listItem.hasClass("active")?(n={left:this.centerX-this.options.imagePadding-s.w*.5+"px",top:"0",width:s.w+"px",height:s.h+"px",padding:this.options.imagePadding+"px"},r=!1,i=e.proxy(this.afterFlowHandler,this),this.listHeight!==s.h&&(this.listHeight=s.h,this.listHeight+=this.options.imagePadding*2,t?this.$list.stop().animate({height:this.listHeight},{duration:this.options.duration,easing:this.options.easing}):this.$list.height(this.listHeight))):(n={left:this.calculateLeftPosition(a,r),top:this.centerY-s.th*.5+"px"},i=null,n.width=s.tw+"px",n.height=s.th+"px",n.padding=this.options.thumbPadding+"px",i=this.getOldActiveAfterFlowHandler(a)),t?this.$listItem.stop().animate(n,{duration:this.options.duration,easing:this.options.easing,complete:i}):(this.$listItem.css(n),i&&i())},flowInDir:function(e,t){if(!this.isEnabled())return!1;t=t!==r?t:this.options.animate;var n=this.activeIndex+e;if(n>this.flowItems.length-1||n<0)return!1;this.activeItem.oldActive=!0;if(e<0&&this.activeIndex>0)this.flowItems[this.activeIndex].oldActive=!0,this.activeIndex+=e;else{if(!(e>0&&this.activeIndex<this.flowItems.length-1))return!1;this.activeIndex+=e}this.activeItem=this.flowItems[this.activeIndex],this.prepareFlow(),this.updateFlow(t)},prepareFlow:function(){this.$caption.hide(),this.$list.find(".active").removeClass("active"),e(this.activeItem.getListItem()).addClass("active"),this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5},calculateLeftPosition:function(e,t){var n=this.centerX,r=0;if(t){n-=this.flowItems[this.activeIndex].w*.5,n-=this.options.imagePadding,n-=(this.activeIndex-e)*10,n-=(this.activeIndex-e)*2*this.options.thumbPadding;for(r=e;r<this.activeIndex;r++)n-=this.flowItems[r].tw}else{n+=this.flowItems[this.activeIndex].w*.5,n+=this.options.imagePadding,n+=(e-this.activeIndex)*10,n+=(e-this.activeIndex)*2*this.options.thumbPadding;for(r=this.activeIndex+1;r<e;r++)n+=this.flowItems[r].tw}return n+"px"},windowResizeHandler:function(){if(!this.isEnabled())return this.resizeWhileDisabled=!0,!1;this.listWidth=this.$container.width(),this.centerX=this.listWidth*.5,this.updateFlow(),this.showCaption()},showCaption:function(){if(!this.activeItem.isLoaded)return!1;var e=this.activeItem.captionText;if(e&&e.length>0){this.$caption.text(e),this.$caption.css({left:this.centerX-this.options.imagePadding-this.activeItem.w*.5,top:this.activeItem.h+this.options.imagePadding*2,width:this.activeItem.w-20});var t=this.activeItem.h+this.$caption.height()+40;this.$caption.fadeIn("fast")}else var t=this.activeItem.h+40},updateListHeight:function(e){e>this.listHeight&&(this.listHeight=e,this.listHeight+=this.options.imagePadding*2,this.$list.height(this.listHeight))},handleKeyEvents:function(e){e.keyCode===37?this.flowInDir(-1):e.keyCode===39&&this.flowInDir(1)}};var u=s.init(o,{getters:["options","activeIndex","length"],methods:["next","prev","jump","isEnabled","enable","disable"],version:i()}),a=function(t,n,r,i){this.listItem=t,this.$listItem=e(t),this.index=n,this.flowGallery=r,this.options=r.options,this.loadCompleteCallback=i,this.h=0,this.th=0,this.w=0,this.tw=0,this.active=!1,this.isLoaded=!1,this.captionText=!1,this.oldActive=!1,this.$img=!1};a.prototype={constructor:a,getListItem:function(){return this.$listItem},init:function(){this.h=this.options.loadingHeight,this.th=this.options.loadingHeight,this.w=this.options.loadingWidth,this.tw=this.options.loadingWidth,this.$img=this.$listItem.find("img"),this.captionText=this.$img.attr("title"),this.options.forceWidth&&this.$img.width(this.options.forceWidth),this.$img.hide().parent().addClass(this.options.loadingClass).css({height:this.th,width:this.tw}),this.addLoadHandler(),this.$listItem.css({backgroundColor:this.options.backgroundColor,padding:this.options.thumbPadding,position:"absolute",textAlign:"center"}),this.$img.css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"}),!this.flowGallery.activeItem&&this.options.activeIndex===this.index&&(this.$listItem.addClass("active"),this.flowGallery.activeItem=this,this.flowGallery.activeIndex=this.index)},addLoadHandler:function(){var t=this.$img.get(0);if(t.complete)this.initListItem();else{var n=this;this.$img.bind("load readystatechange",e.proxy(this.imageLoadHandler,this)).bind("error",function(){n.$img.css("visibility","visible").parent().removeClass(n.options.loadingClass)})}},imageLoadHandler:function(e){var t=this.$img.get(0);(t.complete||t.readyState==="complete"&&e.type==="readystatechange")&&this.initListItem()},initListItem:function(){this.$img.css("visibility","visible").parent().removeClass(this.options.loadingClass),this.$img.fadeIn(),this.isLoaded=!0,this.initImageDimensions(),this.$listItem.click(e.proxy(this.clickHandler,this)),typeof this.loadCompleteCallback=="function"&&this.loadCompleteCallback(this)},initImageDimensions:function(){var e=this.$img.get(0);if(typeof e.naturalWidth!="undefined")this.w=this.options.forceWidth||e.naturalWidth||e.width,this.h=this.options.forceHeight||e.naturalHeight||e.height;else{var t=new Image;t.src=this.$img.attr("src"),this.w=t.width,this.h=t.height}this.options.thumbWidth==="auto"&&this.options.thumbHeight==="auto"?(this.tw=this.options.loadingWidth,this.th=Math.round(this.h*this.options.loadingWidth/this.w)):this.options.thumbHeight==="auto"?(this.tw=this.options.thumbWidth,this.th=Math.round(this.h*Number(this.options.thumbWidth)/this.w)):this.options.thumbWidth==="auto"?(this.tw=Math.round(this.w*Number(this.options.thumbHeight)/this.h),this.th=this.options.thumbHeight):(this.tw=this.options.thumbWidth,this.th=this.options.thumbHeight)},clickHandler:function(){if(this!==this.flowGallery.activeItem){var e=this.flowGallery.activeIndex;this.flowGallery.flowInDir(this.index-e)}else this.options.forwardOnActiveClick===!0&&this.flowGallery.flowInDir(1)}},e.fn.flowgallery=function(t){return this.each(function(){var n=e(this);if(n.data("flowgallery"))return;var r=new u(this,t);n.data("flowgallery",r)})},e.fn.flowgallery.defaults=o.defaults})(jQuery,window,document);
